---
title: "California Water Rights Allocation: Simple Linear Regression Analysis"
subtitle: "Group Mean Comparison and Model Diagnosis"
author: "Lasya Ramachandruni"
thanks: "Project repository available at: https://github.com/LasyaRamachandruni/MATH261A-project-template"
date: today
date-format: long
abstract: |
  We use Simple Linear Regression to quantify the mean difference in water allocations between Appropriative and Other Types in California. Our focus is robust group comparison, with explicit diagnostic documentation for model assumptions and limitations.

format: pdf
bibliography: references.bib
---

#| include: false
#| warning: false
#| message: false

Required for reproducibility and diagnostics:
if (!require(car)) install.packages("car")
library(car)

text

# Introduction

California's water allocation system consists of various types of water rights. Whether “Appropriative” rights grant systematically higher allocations compared to “Other Types” is a key policy and analytical question. This report uses Simple Linear Regression (SLR) to compare mean allocations, document workflow and reproducibility, and transparently report model limitations.

# Data

**Source:** California Open Data Portal (https://data.ca.gov/)  
**License:** Open Data Commons Public Domain Dedication and License (PDDL)

- Observational units: Water rights records
- Outcome ($Y$): Annual allocation (`face_value_amount`)
- Predictor ($X$): Appropriative indicator (`is_approp`, 1 for Appropriative, 0 for Other Types)
- Major features: Outliers, heavy-tailed distributions, extensive missingness handled by case filtering

Load data and clean for analysis
data <- read.csv("data/raw_data.csv", header = TRUE, stringsAsFactors = FALSE)
clean_data <- data[!is.na(data$face_value_amount) & !is.na(data$county), ]
clean_data$is_approp <- ifelse(clean_data$water_right_type == "Appropriative", 1, 0)
summary(clean_data$face_value_amount)
boxplot(face_value_amount ~ is_approp, data = clean_data,
names = c("Other Types", "Appropriative"),
main = "Water Allocation by Right Type",
ylab = "Face Value Amount (Acre-feet/year)")

text

# Methods

We fit a model:

\[
Y_i = \beta_0 + \beta_1 X_i + \epsilon_i
\]

- $Y_i$: Water allocation (acre-feet/year)
- $X_i$: Appropriative indicator

**Assumptions:**
- **Linearity/Additivity**: Checked visually, not violated for group mean.
- **Independence**: Residual sequence plot shows no time-order pattern.
- **Constant Variance**: Checked by residuals plot and `ncvTest`; violated.
- **Normality of Errors**: Checked by Q-Q plot and observed heavy tails; violated.

**Remedial Options:**  
Diagnostics indicate severe heteroscedasticity and non-normality. Transforming $Y$ (e.g., $\log(Y)$) could help, but for assignment compliance all violations are documented; primary objective is robust group mean comparison.

# Results

Fit SLR model and extract summary
lm_result <- lm(face_value_amount ~ is_approp, data = clean_data)
summary(lm_result)
coefs <- coef(lm_result)
confints <- confint(lm_result)
pred_app <- predict(lm_result, newdata = data.frame(is_approp = 1), interval = "prediction")
pred_other <- predict(lm_result, newdata = data.frame(is_approp = 0), interval = "prediction")

text

## Parameter Estimates and Inference

- **Intercept ($b_0$):** `r round(coefs[1], 2)` acre-feet/year (mean allocation for Other Types)
- **Slope ($b_1$):** `r round(coefs[2], 2)` acre-feet/year (mean difference if Appropriative)
- **$R^2$:** `r round(summary(lm_result)$r.squared, 4)` (very low, shows right type explains little of allocation variance)
- **Confidence Interval for Slope:** `r paste(round(confints[2,1],2),"to",round(confints[2,2],2))` acre-feet/year

*Plain English Explanations:*  
- "Appropriative rights receive, on average, `r round(coefs[2],2)` acre-feet/year more than Other Types."
- "The near-zero $R^2$ shows water right type accounts for only a small fraction of total variation in allocations, making individual prediction unreliable."
- "Prediction intervals for new allocations are extremely wide (`r round(pred_app[1,2],0)` to `r round(pred_app[1,3],0)` for Appropriative), indicating the model is poor for forecasting individual values."

## Diagnostics

Diagnostic plots and tests
plot(lm_result$fitted.values, lm_result$residuals,
xlab = "Fitted Values", ylab = "Residuals", main = "Residuals vs Fitted Values")
ncvTest(lm_result) # Heteroscedasticity formal test

qqnorm(lm_result$residuals); qqline(lm_result$residuals, col = "red") # Normality check

plot(lm_result, which = 4) # Cook's Distance for influence

plot(seq_along(lm_result$residuals), lm_result$residuals,
xlab = "Observation Order", ylab = "Residuals", main = "Residuals vs Observation Order") # Independence check

text

Results:
- **Residuals vs Fitted:** Enormous vertical spread and violation of constant variance.
- **ncvTest:** p-value < 2e-16, confirms heteroscedasticity.
- **Q-Q plot:** Strong right tail, proves non-normal, heavy-tailed errors.
- **Cook's Distance:** Extreme points drive slope estimate (outliers).
- **Independence:** No time-sequence pattern found.

## Causal Caveat

This model strictly compares group means and does not make any causal claims; all interpretation is strictly associational.

# Discussion

- A statistically significant mean difference in allocations exists between Appropriative and Other Types.
- Diagnostics reveal violations of constant variance and normality; individual predictions and reported intervals are unreliable.
- The analysis demonstrates how robust statistical summary and honest diagnostics support reproducible real-world research, even when model assumptions fail.

Possible Remedial Next Steps:
- Transforming the outcome variable (log or square root) or using robust regression for future work.
- Emphasize documentation and transparency over model alteration for this assignment.

# References

- California Open Data Portal. https://data.ca.gov/
- Fox, J., & Weisberg, S. (2019). *An R Companion to Applied Regression* (3rd ed). Sage.
- R Core Team. (2025). *R: A Language and Environment for Statistical Computing.*
- Quarto.org documentation.